  <!DOCTYPE html>
  <html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Escala 5x1 - Consulta Rápida</title>
    <style>
      :root{
        --bg:#ffffff;
        --text:#0f172a;
        --muted:#64748b;
        --border:#e5e7eb;
        --accent:#2563eb;
        --accent-2:#0ea5e9;
        --danger:#ef4444;
        --success:#16a34a;
        --warning:#f59e0b;
        --chip:#f1f5f9;
        --shadow:0 1px 2px rgba(0,0,0,.06), 0 4px 10px rgba(0,0,0,.04);
      }
      *{box-sizing:border-box}
      body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--text)}
      header{position:sticky; top:0; z-index:10; background:rgba(255,255,255,.9); backdrop-filter:blur(6px); border-bottom:1px solid var(--border)}
      .container{max-width:1060px; margin:0 auto; padding:16px}
      h1{font-size:20px; margin:0 0 8px}
      .sub{font-size:12px; color:var(--muted)}
      .controls{display:grid; grid-template-columns: repeat(12, 1fr); gap:12px; align-items:end; margin-top:12px}
      .col-4{grid-column:span 4}
      .col-12{grid-column:span 12}
      @media (max-width: 768px){ .col-4{grid-column:span 12} }
      label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
      input[type="date"]{width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#fff; color:var(--text)}
      .chip{display:inline-block; padding:6px 10px; border-radius:999px; background:var(--chip); border:1px solid var(--border); font-size:12px; color:#0f172a}
      .toggle-2{position:relative; width:100%; background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:6px; display:flex; gap:6px}
      .toggle-2 button{flex:1; padding:10px 12px; border:none; border-radius:8px; background:transparent; color:#0f172a; cursor:pointer; font-weight:600}
      .toggle-2 button.active{background:var(--accent); color:#fff}
      .toggle-3{position:relative; width:100%; display:grid; grid-template-columns:1fr 1fr 1fr; gap:6px; background:#fff; border:1px solid var(--border); border-radius:12px; padding:6px; box-shadow:var(--shadow)}
      .toggle-3 button{padding:10px 12px; border:none; border-radius:8px; background:transparent; color:#0f172a; cursor:pointer; font-weight:600}
      .toggle-3 button.active.D{background:#16a34a; color:#fff}
      .toggle-3 button.active.N{background:var(--accent-2); color:#fff}
      .toggle-3 button.active.F{background:var(--danger); color:#fff}
      .list{margin-top:16px; border:1px solid var(--border); border-radius:12px; background:#fff; box-shadow:var(--shadow); overflow:hidden}
      .row{display:grid; grid-template-columns: 2fr 1fr .8fr .8fr 2fr 1.1fr; gap:8px; padding:10px 12px; border-bottom:1px solid var(--border); align-items:center}
      .row.header{background:#f8fafc; font-weight:600}
      .row:last-child{border-bottom:none}
      .count{margin-top:12px; font-size:12px; color:var(--muted)}
      .empty{padding:24px; text-align:center; color:var(--muted)}
      @media (max-width: 640px){ .row{grid-template-columns: 1.6fr .9fr .7fr .7fr 1.5fr 1fr; font-size:13px} }
      .presence{display:flex; align-items:center; gap:10px; justify-content:flex-end}
      .pill{display:flex; gap:8px; align-items:center}
      .dot-btn{width:22px; height:22px; border-radius:999px; border:none; cursor:pointer; box-shadow:inset 0 0 0 2px var(--border)}
      .dot-btn.green{background:var(--success)}
      .dot-btn.red{background:var(--danger)}
      .dot-btn.yellow{background:var(--warning)}
      .dot-btn:active{transform:scale(.98)}
      .mini{display:inline-block; width:10px; height:10px; border-radius:999px}
      .mini.green{background:var(--success)}
      .mini.red{background:var(--danger)}
      .mini.yellow{background:var(--warning)}
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <h1>Consulta Rápida – Escala 5x1</h1>
        <div class="sub">Turnos conforme o PDF enviado. Data espelha o relógio do aparelho. Marque Presente, Falta ou Emprestado — tudo fica salvo no dispositivo.</div>

        <div class="controls">
          <div class="col-4">
            <label>Líder</label>
            <div class="toggle-2" id="leaderToggle">
              <button data-leader="luiz" class="active">Luiz</button>
              <button data-leader="romero">Romero</button>
            </div>
          </div>
          <div class="col-4">
            <label>Turno</label>
            <div class="toggle-3" id="turnoToggle">
              <button data-turno="D" class="active D">Dia</button>
              <button data-turno="N">Noite</button>
              <button data-turno="F">Folga</button>
            </div>
          </div>
          <div class="col-4">
            <label for="date">Data</label>
            <input type="date" id="date"/>
          </div>
          <div class="col-12">
            <span class="chip">Período: 5 a 20 (Novembro)</span>
            <span class="chip">Presença: <span class="mini green"></span> • Falta: <span class="mini red"></span> • Emprestado: <span class="mini yellow"></span></span>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <div class="count" id="count"></div>
      <div class="list" id="list">
        <div class="row header">
          <div>Nome</div>
          <div>Matrícula</div>
          <div>Turma</div>
          <div>Turno</div>
          <div>Função</div>
          <div class="presence">Marcação</div>
        </div>
        <div id="body"></div>
      </div>
      <div class="empty" id="empty" style="display:none">Nenhum registro para os filtros.</div>
    </main>

    <script>
      const STORAGE_KEY = "escala_presencas_v2";
      const LEADERS = {
        luiz: [670, 671, 672, 673, 674, 675],
        romero: [676, 677, 678, 679, 680, 681],
      };

      function getLocalDateStringToday(){
        const now = new Date();
        const localISO = new Date(now.getTime() - now.getTimezoneOffset()*60000).toISOString();
        return localISO.slice(0,10);
      }
      function dayFromDate(dateStr){
        const [y,m,d] = dateStr.split("-").map(n=>parseInt(n,10));
        if(!y||!m||!d) return null;
        const dt = new Date(y, m-1, d, 12, 0, 0);
        return isNaN(dt) ? null : dt.getDate();
      }

      // BASE 100% derivada do PDF enviado (5–20)
      const DATA = [
        // Luiz 670–675
        { local:"OPERADOR POÇO", mat:"108817", nome:"RAFAEL WALLACE", turma:670, agenda:{5:"D",6:"D",7:"D",8:"D",9:"D",10:"F",11:"N",12:"N",13:"N",14:"N",15:"N",16:"F",17:"D",18:"D",19:"D",20:"D"} },
        { local:"OPERADOR RIO", mat:"108813", nome:"JOSE CARLOS", turma:671, agenda:{5:"F",6:"D",7:"D",8:"D",9:"D",10:"D",11:"F",12:"N",13:"N",14:"N",15:"N",16:"N",17:"F",18:"D",19:"D",20:"D"} },
        { local:"CONV. 1 CARRAPICHO", mat:"108815", nome:"MATEUS HENRIQUE", turma:672, agenda:{5:"N",6:"F",7:"D",8:"D",9:"D",10:"D",11:"D",12:"F",13:"N",14:"N",15:"N",16:"N",17:"N",18:"F",19:"D",20:"D"} },
        { local:"CONV. 2 CARRAPICHO", mat:"108818", nome:"TIAGO GALDINO", turma:673, agenda:{5:"N",6:"N",7:"F",8:"D",9:"D",10:"D",11:"D",12:"D",13:"F",14:"N",15:"N",16:"N",17:"N",18:"N",19:"F",20:"D"} },
        { local:"CONV. 2 CARRAPICHO", mat:"108814", nome:"MADSON DE SANTANA", turma:674, agenda:{5:"N",6:"N",7:"N",8:"F",9:"D",10:"D",11:"D",12:"D",13:"D",14:"F",15:"N",16:"N",17:"N",18:"N",19:"N",20:"F"} },
        { local:"FOLGUISTA", mat:"109092", nome:"JOSEILDO VICENTE", turma:675, agenda:{5:"N",6:"N",7:"N",8:"N",9:"F",10:"D",11:"D",12:"D",13:"D",14:"D",15:"F",16:"N",17:"N",18:"N",19:"N",20:"N"} },

        { local:"OPERADOR PASMADO", mat:"108445", nome:"JOSE GERVASIO", turma:670, agenda:{5:"D",6:"D",7:"D",8:"D",9:"D",10:"F",11:"N",12:"N",13:"N",14:"N",15:"N",16:"F",17:"D",18:"D",19:"D",20:"D"} },
        { local:"CONV. PASMADO", mat:"108432", nome:"DANIEL ALVES", turma:671, agenda:{5:"F",6:"D",7:"D",8:"D",9:"D",10:"D",11:"F",12:"N",13:"N",14:"N",15:"N",16:"N",17:"F",18:"D",19:"D",20:"D"} },
        { local:"CONV. 1 CARRAPICHO", mat:"108812", nome:"JOAO VITOR", turma:672, agenda:{5:"N",6:"F",7:"D",8:"D",9:"D",10:"D",11:"D",12:"F",13:"N",14:"N",15:"N",16:"N",17:"N",18:"F",19:"D",20:"D"} },
        { local:"BAIXA PRESSAO PASM.", mat:"108614", nome:"ENIO PEREIRA", turma:673, agenda:{5:"N",6:"N",7:"F",8:"D",9:"D",10:"D",11:"D",12:"D",13:"F",14:"N",15:"N",16:"N",17:"N",18:"N",19:"F",20:"D"} },
        { local:"SOBRA", mat:"108674", nome:"TIAGO HENRIQUE", turma:674, agenda:{5:"N",6:"N",7:"N",8:"F",9:"D",10:"D",11:"D",12:"D",13:"D",14:"F",15:"N",16:"N",17:"N",18:"N",19:"N",20:"F"} },
        { local:"FOLGUISTA", mat:"108725", nome:"JEAN MARCOS", turma:675, agenda:{5:"N",6:"N",7:"N",8:"N",9:"F",10:"D",11:"D",12:"D",13:"D",14:"D",15:"F",16:"N",17:"N",18:"N",19:"N",20:"N"} },

        { local:"POÇO BURRO VELHO", mat:"105510", nome:"EDSON FERNANDO", turma:670, agenda:{5:"D",6:"D",7:"D",8:"D",9:"D",10:"F",11:"N",12:"N",13:"N",14:"N",15:"N",16:"F",17:"D",18:"D",19:"D",20:"D"} },
        { local:"APOIO", mat:"108801", nome:"PEDRO GUILHERME", turma:671, agenda:{5:"F",6:"D",7:"D",8:"D",9:"D",10:"D",11:"F",12:"N",13:"N",14:"N",15:"N",16:"N",17:"F",18:"D",19:"D",20:"D"} },
        { local:"PIVOT B1", mat:"105599", nome:"WANDERSON JOSE", turma:672, agenda:{5:"N",6:"F",7:"D",8:"D",9:"D",10:"D",11:"D",12:"F",13:"N",14:"N",15:"N",16:"N",17:"N",18:"F",19:"D",20:"D"} },
        { local:"PIVOT B2", mat:"108601", nome:"BRENO RAY", turma:673, agenda:{5:"N",6:"N",7:"F",8:"D",9:"D",10:"D",11:"D",12:"D",13:"F",14:"N",15:"N",16:"N",17:"N",18:"N",19:"F",20:"D"} },
        { local:"OP. PASSAGEM MANGAIPE", mat:"109088", nome:"EVANDRO RAIMUDO", turma:674, agenda:{5:"N",6:"N",7:"N",8:"F",9:"D",10:"D",11:"D",12:"D",13:"D",14:"F",15:"N",16:"N",17:"N",18:"N",19:"N",20:"F"} },
        { local:"FOLGUISTA", mat:"108748", nome:"JUNIOR RICARDO", turma:675, agenda:{5:"N",6:"N",7:"N",8:"N",9:"F",10:"D",11:"D",12:"D",13:"D",14:"D",15:"F",16:"N",17:"N",18:"N",19:"N",20:"N"} },

        // Romero 676–681
        { local:"OPERADOR POÇO", mat:"108810", nome:"GUTEMBERG BENARDO", turma:676, agenda:{5:"N",6:"N",7:"N",8:"N",9:"N",10:"F",11:"D",12:"D",13:"D",14:"D",15:"D",16:"F",17:"N",18:"N",19:"N",20:"N"} },
        { local:"OPERADOR RIO", mat:"108816", nome:"PEDRO CARLOS", turma:677, agenda:{5:"F",6:"N",7:"N",8:"N",9:"N",10:"N",11:"F",12:"D",13:"D",14:"D",15:"D",16:"D",17:"F",18:"N",19:"N",20:"N"} },
        { local:"CONV. 1 CARRAPICHO", mat:"108809", nome:"ARLAN ANTONIO", turma:678, agenda:{5:"D",6:"F",7:"N",8:"N",9:"N",10:"N",11:"N",12:"F",13:"D",14:"D",15:"D",16:"D",17:"D",18:"F",19:"N",20:"N"} },
        { local:"CONV. 2 CARRAPICHO", mat:"108811", nome:"IGOR SILVA", turma:679, agenda:{5:"D",6:"D",7:"F",8:"N",9:"N",10:"N",11:"N",12:"N",13:"F",14:"D",15:"D",16:"D",17:"D",18:"D",19:"F",20:"N"} },
        { local:"CONV. 2 CARRAPICHO", mat:"108807", nome:"GILIADRO FERREIRA", turma:680, agenda:{5:"D",6:"D",7:"D",8:"F",9:"N",10:"N",11:"N",12:"N",13:"N",14:"F",15:"D",16:"D",17:"D",18:"D",19:"D",20:"F"} },
        { local:"FOLGUISTA", mat:"109099", nome:"MANOEL ROBERTO", turma:681, agenda:{5:"D",6:"D",7:"D",8:"D",9:"F",10:"N",11:"N",12:"N",13:"N",14:"N",15:"F",16:"D",17:"D",18:"D",19:"D",20:"D"} },

        { local:"OPERADOR PASMADO", mat:"108432", nome:"GUTEMBERGUE DA SILVA", turma:676, agenda:{5:"N",6:"N",7:"N",8:"N",9:"N",10:"F",11:"D",12:"D",13:"D",14:"D",15:"D",16:"F",17:"N",18:"N",19:"N",20:"N"} },
        { local:"CONV. PASMADO", mat:"108430", nome:"RUAN FERNANDO", turma:677, agenda:{5:"F",6:"N",7:"N",8:"N",9:"N",10:"N",11:"F",12:"D",13:"D",14:"D",15:"D",16:"D",17:"F",18:"N",19:"N",20:"N"} },
        { local:"CONV. 1 CARRAPICHO", mat:"108808", nome:"VICTOR IZAU", turma:678, agenda:{5:"D",6:"F",7:"N",8:"N",9:"N",10:"N",11:"N",12:"F",13:"D",14:"D",15:"D",16:"D",17:"D",18:"F",19:"N",20:"N"} },
        { local:"CONV. PASMADO", mat:"107118", nome:"GERSON FELIPE", turma:679, agenda:{5:"D",6:"D",7:"F",8:"N",9:"N",10:"N",11:"N",12:"N",13:"F",14:"D",15:"D",16:"D",17:"D",18:"D",19:"F",20:"N"} },
        { local:"SOBRA", mat:"108806", nome:"FELIPE MAURICIO", turma:680, agenda:{5:"D",6:"D",7:"D",8:"F",9:"N",10:"N",11:"N",12:"N",13:"N",14:"F",15:"D",16:"D",17:"D",18:"D",19:"D",20:"F"} },
        { local:"FOLGUISTA", mat:"108771", nome:"MATEUS RIBEIRO", turma:681, agenda:{5:"D",6:"D",7:"D",8:"D",9:"F",10:"N",11:"N",12:"N",13:"N",14:"N",15:"F",16:"D",17:"D",18:"D",19:"D",20:"D"} },

        // Bloco “B. PRESSAO BOTA FOGO” do PDF: Leandro José estava em 670 e dia 6 = D
        { local:"B. PRESSAO BOTA FOGO", mat:"109087", nome:"LEANDRO JOSE", turma:670, agenda:{5:"D",6:"D",7:"D",8:"D",9:"D",10:"F",11:"N",12:"N",13:"N",14:"N",15:"N",16:"F",17:"D",18:"D",19:"D",20:"D"} },
        { local:"B. PRESSAO BOTA FOGO", mat:"109090", nome:"MARCIO ABDIAS", turma:671, agenda:{5:"F",6:"D",7:"D",8:"D",9:"D",10:"D",11:"F",12:"N",13:"N",14:"N",15:"N",16:"N",17:"F",18:"D",19:"D",20:"D"} },
        { local:"BAIXA PRESSAO BV", mat:"109027", nome:"MARCONE JOSE", turma:672, agenda:{5:"N",6:"F",7:"D",8:"D",9:"D",10:"D",11:"D",12:"F",13:"N",14:"N",15:"N",16:"N",17:"N",18:"F",19:"D",20:"D"} },
        { local:"BAIXA PRESSAO BV", mat:"108720", nome:"GABRIEL DIAS", turma:673, agenda:{5:"N",6:"N",7:"F",8:"D",9:"D",10:"D",11:"D",12:"D",13:"F",14:"N",15:"N",16:"N",17:"N",18:"N",19:"F",20:"D"} },
        { local:"OP BOTA FOGO BP", mat:"109093", nome:"JAILSON BATISTA", turma:674, agenda:{5:"N",6:"N",7:"N",8:"F",9:"D",10:"D",11:"D",12:"D",13:"D",14:"F",15:"N",16:"N",17:"N",18:"N",19:"N",20:"F"} },
        { local:"FOLGUISTA", mat:"108766", nome:"WLLISSES ISAAC", turma:675, agenda:{5:"N",6:"N",7:"N",8:"N",9:"F",10:"D",11:"D",12:"D",13:"D",14:"D",15:"F",16:"N",17:"N",18:"N",19:"N",20:"N"} },

        // Demais blocos do PDF (adicionados conforme leitura do texto)
        { local:"B. PRESSAO M. FEDERAL", mat:"108755", nome:"LUIZ HENRIQUE", turma:670, agenda:{5:"D",6:"D",7:"D",8:"D",9:"D",10:"F",11:"N",12:"N",13:"N",14:"N",15:"N",16:"F",17:"D",18:"D",19:"D",20:"D"} },
        { local:"B. PRESSAO M. FEDERAL", mat:"107955", nome:"EDUARDO PEREIRA", turma:671, agenda:{5:"F",6:"D",7:"D",8:"D",9:"D",10:"D",11:"F",12:"N",13:"N",14:"N",15:"N",16:"N",17:"F",18:"D",19:"D",20:"D"} },
        { local:"B. PRESSAO M. 27419", mat:"108713", nome:"BRENO HENRIQUE", turma:672, agenda:{5:"N",6:"F",7:"D",8:"D",9:"D",10:"D",11:"D",12:"F",13:"N",14:"N",15:"N",16:"N",17:"N",18:"F",19:"D",20:"D"} },
        { local:"B. PRESSAO M. 27419", mat:"108625", nome:"GABRIEL RIBEIRO", turma:673, agenda:{5:"N",6:"N",7:"F",8:"D",9:"D",10:"D",11:"D",12:"D",13:"F",14:"N",15:"N",16:"N",17:"N",18:"N",19:"F",20:"D"} },
        { local:"OP. MANGAIPE DEDE", mat:"108627", nome:"GEREMIAS ROSA", turma:674, agenda:{5:"N",6:"N",7:"N",8:"F",9:"D",10:"D",11:"D",12:"D",13:"D",14:"F",15:"N",16:"N",17:"N",18:"N",19:"N",20:"F"} },
        { local:"FOLGUISTA", mat:"109083", nome:"JOSE CARLOS", turma:675, agenda:{5:"N",6:"N",7:"N",8:"N",9:"F",10:"D",11:"D",12:"D",13:"D",14:"D",15:"F",16:"N",17:"N",18:"N",19:"N",20:"N"} },

        // Conjuntos alternativos do PDF (com outras matrículas e nomes)
        { local:"POÇO BURRO VELHO", mat:"106411", nome:"ALEF SEVERINO", turma:676, agenda:{5:"N",6:"N",7:"N",8:"N",9:"N",10:"F",11:"D",12:"D",13:"D",14:"D",15:"D",16:"F",17:"N",18:"N",19:"N",20:"N"} },
        { local:"APOIO", mat:"108762", nome:"RODRIGO ADOLFO", turma:677, agenda:{5:"F",6:"N",7:"N",8:"N",9:"N",10:"N",11:"F",12:"D",13:"D",14:"D",15:"D",16:"D",17:"F",18:"N",19:"N",20:"N"} },
        { local:"PIVOT B1", mat:"86373", nome:"DACIEL MARTINS", turma:678, agenda:{5:"D",6:"F",7:"N",8:"N",9:"N",10:"N",11:"N",12:"F",13:"D",14:"D",15:"D",16:"D",17:"D",18:"F",19:"N",20:"N"} },
        { local:"PIVOT B2", mat:"61276", nome:"DJAIR GOMES", turma:679, agenda:{5:"D",6:"D",7:"F",8:"N",9:"N",10:"N",11:"N",12:"N",13:"F",14:"D",15:"D",16:"D",17:"D",18:"D",19:"F",20:"N"} },
        { local:"OP. PASSAGEM MANGAIPE", mat:"105550", nome:"JOSE RICARDO", turma:680, agenda:{5:"D",6:"D",7:"D",8:"F",9:"N",10:"N",11:"N",12:"N",13:"N",14:"F",15:"D",16:"D",17:"D",18:"D",19:"D",20:"F"} },
        { local:"FOLGUISTA", mat:"108605", nome:"DIOGO JOSE", turma:681, agenda:{5:"D",6:"D",7:"D",8:"D",9:"F",10:"N",11:"N",12:"N",13:"N",14:"N",15:"F",16:"D",17:"D",18:"D",19:"D",20:"D"} },

        { local:"B. PRESSAO M. FEDERAL", mat:"108573", nome:"ADRIANO DA SILVA", turma:677, agenda:{5:"F",6:"N",7:"N",8:"N",9:"N",10:"N",11:"F",12:"D",13:"D",14:"D",15:"D",16:"D",17:"F",18:"N",19:"N",20:"N"} },
        { local:"B. PRESSAO M. 27419", mat:"108760", nome:"REGINALDO TRAJANO", turma:678, agenda:{5:"D",6:"F",7:"N",8:"N",9:"N",10:"N",11:"N",12:"F",13:"D",14:"D",15:"D",16:"D",17:"D",18:"F",19:"N",20:"N"} },
        { local:"B. PRESSAO M. 27419", mat:"108854", nome:"ANDRE PEREIRA", turma:679, agenda:{5:"D",6:"D",7:"F",8:"N",9:"N",10:"N",11:"N",12:"N",13:"F",14:"D",15:"D",16:"D",17:"D",18:"D",19:"F",20:"N"} },
        { local:"OP. MANGAIPE DEDE", mat:"108746", nome:"JOSE SEBASTIÃO", turma:680, agenda:{5:"D",6:"D",7:"D",8:"F",9:"N",10:"N",11:"N",12:"N",13:"N",14:"F",15:"D",16:"D",17:"D",18:"D",19:"D",20:"F"} },
        { local:"FOLGUISTA", mat:"109084", nome:"JADSON NUNES", turma:681, agenda:{5:"D",6:"D",7:"D",8:"D",9:"F",10:"N",11:"N",12:"N",13:"N",14:"N",15:"F",16:"D",17:"D",18:"D",19:"D",20:"D"} },
        { local:"SOBRA", mat:"108781", nome:"RAUL FIGUEREDO", turma:681, agenda:{5:"D",6:"D",7:"D",8:"D",9:"F",10:"N",11:"N",12:"N",13:"N",14:"N",15:"F",16:"D",17:"D",18:"D",19:"D",20:"D"} },
      ];

      function loadStorage(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||"{}"); }catch(e){ return {}; } }
      function saveStorage(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
      function presenceKey(dateStr, leaderKey){ return `${dateStr}::${leaderKey}`; }
      function getPresenceMap(dateStr, leaderKey){ const s=loadStorage(); return s[presenceKey(dateStr, leaderKey)]||{}; }
      function setPresence(dateStr, leaderKey, matricula, status){
        const s = loadStorage();
        const key = presenceKey(dateStr, leaderKey);
        if(!s[key]) s[key] = {};
        if(status) s[key][matricula] = status; else delete s[key][matricula];
        saveStorage(s);
      }

      const leaderToggle = document.getElementById("leaderToggle");
      const turnoToggle = document.getElementById("turnoToggle");
      const dateInput = document.getElementById("date");
      const bodyEl = document.getElementById("body");
      const listEl = document.getElementById("list");
      const emptyEl = document.getElementById("empty");
      const countEl = document.getElementById("count");
      let leader = "luiz";
      let turno = "D";

      function initDateToDeviceToday(){ dateInput.value = getLocalDateStringToday(); }

      leaderToggle.addEventListener("click", (e)=>{
        const btn = e.target.closest("button"); if(!btn) return;
        leader = btn.dataset.leader;
        [...leaderToggle.querySelectorAll("button")].forEach(b=>b.classList.toggle("active", b===btn));
        render();
      });

      turnoToggle.addEventListener("click", (e)=>{
        const btn = e.target.closest("button"); if(!btn) return;
        turno = btn.dataset.turno;
        [...turnoToggle.querySelectorAll("button")].forEach(b=>{ b.classList.toggle("active", b===btn); b.classList.remove("D","N","F"); });
        btn.classList.add(turno);
        render();
      });

      function teamsForLeader(key){ const allowed=new Set(LEADERS[key]); return DATA.filter(p=>allowed.has(p.turma)); }
      function statusOnDate(pessoa, dateStr){
        const d=dayFromDate(dateStr);
        if(d==null||d<5||d>20) return null;
        return pessoa.agenda[String(d)];
      }

      function render(){
        const team = teamsForLeader(leader);
        const date = dateInput.value || getLocalDateStringToday();
        const presenceMap = getPresenceMap(date, leader);

        const rows = team.map(p=>{
          const st = statusOnDate(p, date);
          return st ? {nome:p.nome, mat:p.mat, turma:p.turma, turno:st, func:p.local} : null;
        }).filter(Boolean).filter(r=>r.turno===turno).sort((a,b)=>(a.turma-b.turma)||a.nome.localeCompare(b.nome));

        bodyEl.innerHTML = "";
        if (!rows.length){ listEl.style.display="none"; emptyEl.style.display="block"; }
        else{
          listEl.style.display="block"; emptyEl.style.display="none";
          for (const r of rows){
            const saved = presenceMap[r.mat];
            const div = document.createElement("div");
            div.className = "row";
            div.innerHTML = `
              <div>${r.nome}</div>
              <div>${r.mat}</div>
              <div>${r.turma}</div>
              <div>${r.turno}</div>
              <div>${r.func}</div>
              <div class="presence">
                <div class="pill" data-mat="${r.mat}">
                  <button class="dot-btn ${saved==='present'?'green':''}" data-kind="present" title="Presente"></button>
                  <button class="dot-btn ${saved==='absent'?'red':''}" data-kind="absent" title="Falta"></button>
                  <button class="dot-btn ${saved==='loan'?'yellow':''}" data-kind="loan" title="Emprestado"></button>
                </div>
              </div>
            `;
            bodyEl.appendChild(div);
          }
          bodyEl.querySelectorAll(".pill").forEach(pill=>{
            pill.addEventListener("click", (e)=>{
              const btn = e.target.closest(".dot-btn"); if(!btn) return;
              const mat = pill.getAttribute("data-mat");
              const kind = btn.getAttribute("data-kind");
              const isActive = btn.classList.contains(kind==='present'?'green':kind==='absent'?'red':'yellow');
              pill.querySelectorAll(".dot-btn").forEach(b=>b.classList.remove("green","red","yellow"));
              if (!isActive){
                if(kind==='present') btn.classList.add("green");
                if(kind==='absent') btn.classList.add("red");
                if(kind==='loan') btn.classList.add("yellow");
                setPresence(date, leader, mat, kind);
              } else {
                setPresence(date, leader, mat, null);
              }
              updateSummary(rows, date);
            });
          });
        }
        updateSummary(rows, date);
      }

      function updateSummary(rows, date){
        const leaderLabel = leader === "luiz" ? "Luiz" : "Romero";
        const dateLabel = new Date(date + "T12:00:00").toLocaleDateString("pt-BR");
        const turnoLabel = turno === "D" ? "Dia" : (turno === "N" ? "Noite" : "Folga");

        const map = getPresenceMap(date, leader);
        const mats = rows.map(r=>r.mat);
        const present = mats.filter(m=>map[m]==='present').length;
        const absent  = mats.filter(m=>map[m]==='absent').length;
        const loan    = mats.filter(m=>map[m]==='loan').length;

        countEl.textContent = `${rows.length} registro(s) • ${dateLabel} • Líder: ${leaderLabel} • Turno: ${turnoLabel} • Presente: ${present} • Falta: ${absent} • Emprestado: ${loan}`;
      }

      dateInput.addEventListener("change", render);

      initDateToDeviceToday();
      leaderToggle.querySelector('[data-leader="luiz"]').classList.add("active");
      turnoToggle.querySelector('[data-turno="D"]').classList.add("active","D");
      render();
    </script>
  </body>
  </html>
